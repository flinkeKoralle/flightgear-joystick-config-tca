<?xml version="1.0"?>

<PropertyList>
  <name type="string">Thrustmaster T.A320 Pilot</name>

  <nasal>
    <script><![CDATA[
    var this = cmdarg().getParent();

    var load_overlay = func(name) {
        if (name == nil) return;
        foreach (var dir; [getprop("/sim/fg-home"), getprop("/sim/fg-root")]) {
            var file = dir ~ "/Input/Joysticks/overlay/TA320-Pilot/" ~ name ~ ".xml";
            if (io.stat(file) != nil) {
                print("Loading overlay " ~ file);
                cmdarg().setValues({command: "nasal", script: ""});
                io.read_properties(file, this);
                props.runBinding(cmdarg());
                break;
            }
        }
    }

    var family_patterns = [
        [ "777-*", "777" ],
        [ "dhc6*", "DHC6" ],
        [ "PA28-*", "P28A" ],
        [ "Citation-II*", "C550" ],
        [ "Embraer1[79][05]", "E170" ],
        [ "EmbraerLineage1000", "E170" ],
    ];

    var subtype = getprop('/sim/aircraft');
    var type = getprop('/sim/variant-of');
    var family = nil;
    foreach (var pattern; family_patterns) {
        if (string.match(subtype, pattern[0])) {
            family = pattern[1];
            break;
        }
    }

    print("Type: " ~ type ~ " [" ~ (subtype or '?') ~ "] (" ~ (family or '?') ~ ")");

    load_overlay(type);
    load_overlay(subtype);
    load_overlay(family);
]]></script>
  </nasal>

  <axis>
    <desc type="string">Aileron</desc>
    <binding>
      <command type="string">property-scale</command>
      <property type="string">/controls/flight/aileron</property>
      <factor type="double">1</factor>
      <offset type="double">0</offset>
      <power type="double">1</power>
    </binding>
  </axis>
  <axis n="1">
    <desc type="string">Elevator</desc>
    <binding>
      <command type="string">property-scale</command>
      <property type="string">/controls/flight/elevator</property>
      <factor type="double">-1</factor>
      <offset type="double">0</offset>
      <power type="double">1</power>
    </binding>
  </axis>
  <axis n="3">
    <desc type="string">Mixture All Engines</desc>
    <binding>
      <command type="string">property-scale</command>
      <property type="string">/controls/engines/mixture-all</property>
      <factor type="double">1</factor>
      <offset type="double">0</offset>
      <power type="double">1</power>
    </binding>
  </axis>
  <axis n="4">
    <desc type="string">Aileron Trim inc.</desc>
    <low>
      <binding>
        <command type="string">nasal</command>
        <script type="string">controls.aileronTrim(1);</script>
      </binding>
      <repeatable type="bool">true</repeatable>
    </low>
    <high>
      <binding>
        <command type="string">nasal</command>
        <script type="string">controls.aileronTrim(-1);</script>
      </binding>
      <repeatable type="bool">true</repeatable>
    </high>
  </axis>
  <axis n="5">
    <desc type="string">Elevator Trim inc.</desc>
    <low>
      <binding>
        <command type="string">nasal</command>
        <script type="string">controls.elevatorTrim(1);</script>
      </binding>
      <repeatable type="bool">true</repeatable>
    </low>
    <high>
      <binding>
        <command type="string">nasal</command>
        <script type="string">controls.elevatorTrim(-1);</script>
      </binding>
      <repeatable type="bool">true</repeatable>
    </high>
  </axis>
  <button n="3">
    <desc type="string">Autopilot disconnect</desc>
    <binding>
      <command type="string">nasal</command>
      <script type="string">controls.autopilotDisconnect();</script>
    </binding>
    <repeatable type="double">0</repeatable>
  </button>
</PropertyList>

<?xml version="1.0"?>

<PropertyList>
  <name type="string">Thrustmaster TCA Q-Eng 1&amp;2</name>

  <nasal>
    <script><![CDATA[
    var this = cmdarg().getParent();

    var load_overlay = func(name) {
        if (name == nil) return;
        foreach (var dir; [getprop("/sim/fg-home"), getprop("/sim/fg-root")]) {
            var file = dir ~ "/Input/Joysticks/overlay/TCA-Q-Eng12/" ~ name ~ ".xml";
            if (io.stat(file) != nil) {
                print("Loading overlay " ~ file);
                cmdarg().setValues({command: "nasal", script: ""});
                io.read_properties(file, this);
                props.runBinding(cmdarg());
                break;
            }
        }
    }

    var family_patterns = [
        [ "777-*", "777" ],
        [ "dhc6*", "DHC6" ],
        [ "PA28-*", "P28A" ],
        [ "Citation-II*", "C550" ],
        [ "Embraer1[79][05]", "E170" ],
        [ "EmbraerLineage1000", "E170" ],
    ];

    var subtype = getprop('/sim/aircraft');
    var type = getprop('/sim/variant-of');
    var family = nil;
    foreach (var pattern; family_patterns) {
        if (string.match(subtype, pattern[0])) {
            family = pattern[1];
            break;
        }
    }

    print("Type: " ~ type ~ " [" ~ (subtype or '?') ~ "] (" ~ (family or '?') ~ ")");

    load_overlay(type);
    load_overlay(subtype);
    load_overlay(family);
]]></script>
  </nasal>

  <axis n="0">
    <desc type="string">Throttle Engine 1</desc>
    <binding>
      <condition>
        <property>/controls/engines/engine[0]/reverser</property>
      </condition>
      <command type="string">property-scale</command>
      <property type="string">/controls/engines/engine[0]/throttle</property>
      <factor type="double">4</factor>
      <offset type="double">-0.75</offset>
      <power type="double">1</power>
    </binding>
    <binding>
      <condition>
        <not>
            <property>/controls/engines/engine[0]/reverser</property>
        </not>
      </condition>
      <command type="string">property-scale</command>
      <property type="string">/controls/engines/engine[0]/throttle</property>
      <factor type="double">-0.69</factor>
      <offset type="double">-0.40</offset>
      <power type="double">1</power>
    </binding>
  </axis>
  <button n="11">
    <desc type="string">Reverser 1</desc>
    <binding>
      <command type="string">property-assign</command>
      <property type="string">/controls/engines/engine[0]/reverser</property>
      <value type="bool">true</value>
    </binding>
    <mod-up>
      <binding>
          <command type="string">property-assign</command>
          <property type="string">/controls/engines/engine[0]/reverser</property>
          <value type="bool">false</value>
      </binding>
    </mod-up>
  </button>
  <axis n="1">
    <desc type="string">Throttle Engine 2</desc>
    <binding>
      <condition>
        <property>/controls/engines/engine[1]/reverser</property>
      </condition>
      <command type="string">property-scale</command>
      <property type="string">/controls/engines/engine[1]/throttle</property>
      <factor type="double">4</factor>
      <offset type="double">-0.75</offset>
      <power type="double">1</power>
    </binding>
    <binding>
      <condition>
        <not>
            <property>/controls/engines/engine[1]/reverser</property>
        </not>
      </condition>
      <command type="string">property-scale</command>
      <property type="string">/controls/engines/engine[1]/throttle</property>
      <factor type="double">-0.69</factor>
      <offset type="double">-0.40</offset>
      <power type="double">1</power>
    </binding>
  </axis>
  <button n="15">
    <desc type="string">Reverser 2</desc>
    <binding>
      <command type="string">property-assign</command>
      <property type="string">/controls/engines/engine[1]/reverser</property>
      <value type="bool">true</value>
    </binding>
    <mod-up>
      <binding>
          <command type="string">property-assign</command>
          <property type="string">/controls/engines/engine[1]/reverser</property>
          <value type="bool">false</value>
      </binding>
    </mod-up>
  </button>
  <axis n="3">
    <desc type="string">Brake Right</desc>
    <binding>
      <command type="string">property-scale</command>
      <property type="string">/controls/gear/brake-right</property>
      <factor type="double">-0.5</factor>
      <offset type="double">-1</offset>
      <power type="double">1</power>
    </binding>
  </axis>
  <axis n="4">
    <desc type="string">Brake Left</desc>
    <binding>
      <command type="string">property-scale</command>
      <property type="string">/controls/gear/brake-left</property>
      <factor type="double">-0.5</factor>
      <offset type="double">-1</offset>
      <power type="double">1</power>
    </binding>
  </axis>
  <axis n="6">
    <desc type="string">Rudder</desc>
    <binding>
      <command type="string">property-scale</command>
      <property type="string">/controls/flight/rudder</property>
      <factor type="double">1</factor>
      <offset type="double">0</offset>
      <power type="double">1</power>
    </binding>
  </axis>
</PropertyList>
